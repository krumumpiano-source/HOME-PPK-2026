<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อมูลการชำระเงินย้อนหลัง | HOME PPK 2026</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&display=swap');

        :root {
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e5e7eb;
            --text: #0f172a;
            --muted: #64748b;
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --shadow: 0 8px 24px rgba(15,23,42,.06);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Kanit', sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 62px;
            background: linear-gradient(135deg, #2563eb 0%, #38e8ff 100%);
            box-shadow: 2px 0 12px rgba(0,0,0,0.07);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.2rem 0.3rem;
            transition: width 0.2s;
            z-index: 100;
        }
        .sidebar.expanded { width: 280px; align-items: flex-start; padding-left: 0.7rem; }
        .sidebar-toggle {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.7rem;
            margin-bottom: 1.2rem;
            cursor: pointer;
            outline: none;
            align-self: flex-end;
        }
        .sidebar-menu { display: flex; flex-direction: column; gap: 0.2rem; width: 100%; flex: 1; }
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.9rem;
            color: #fff;
            background: none;
            border: none;
            font-size: 1.08rem;
            font-family: inherit;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            width: 100%;
            transition: background 0.15s, color 0.15s;
        }
        .sidebar-link.active, .sidebar-link:hover { background: #fff; color: #2563eb; }
        .sidebar-link-icon { font-size: 1.25rem; min-width: 1.5em; text-align: center; }
        .sidebar-label { display: none; font-size: 1rem; line-height: 1.3; }
        .sidebar.expanded .sidebar-label { display: inline; }

        @media (max-width: 600px) {
            .sidebar { width: 48px; }
            .sidebar.expanded { width: 160px; }
        }

        /* Main Container */
        .dashboard-container {
            margin-left: 62px;
            min-height: 100vh;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            align-items: center;
            transition: margin-left 0.2s;
        }
        .sidebar.expanded ~ .dashboard-container { margin-left: 280px; }
        @media (max-width: 600px) {
            .dashboard-container { margin-left: 48px; padding: 1rem; }
            .sidebar.expanded ~ .dashboard-container { margin-left: 160px; }
        }

        /* Header */
        .dashboard-header {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            margin-bottom: 0.5rem;
            justify-content: center;
        }
        .dashboard-header-icon {
            font-size: 2.1rem;
            color: var(--primary);
        }
        .dashboard-container h2 {
            margin: 0;
            color: var(--primary);
            font-weight: 700;
            font-size: 1.8rem;
            text-align: center;
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
            flex-wrap: wrap;
            background: var(--surface);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }
        .filter-section label {
            font-size: 0.95rem;
            color: var(--text);
            font-weight: 600;
        }
        .filter-section select {
            padding: 0.6rem 0.8rem;
            font-size: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
        }
        .filter-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-family: inherit;
        }
        .filter-btn:hover {
            background: var(--primary-dark);
        }

        /* Payment History Container */
        .payment-history-container {
            width: 100%;
            max-width: 1000px;
            background: var(--surface);
            border-radius: 14px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .payment-history-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            text-align: center;
        }
        .payment-history-container th,
        .payment-history-container td {
            border: 1px solid var(--border);
            padding: 0.75rem 0.6rem;
        }
        .payment-history-container th {
            background: #e2e8f0;
            color: var(--text);
            font-weight: 700;
        }
        .payment-history-container tr:nth-child(even) {
            background: #f8fafc;
        }
        .payment-history-container tr:hover {
            background: #f1f5f9;
        }
        .payment-history-container td {
            color: var(--text);
        }

        /* Stat Cards */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 1000px;
        }
        @media (max-width: 700px) { .stat-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 400px) { .stat-grid { grid-template-columns: 1fr; } }
        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.2rem 1rem;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            border-radius: 14px 14px 0 0;
        }
        .stat-card.c-total::before  { background: linear-gradient(90deg,#2563eb,#38e8ff); }
        .stat-card.c-water::before  { background: linear-gradient(90deg,#06b6d4,#38e8ff); }
        .stat-card.c-elec::before   { background: linear-gradient(90deg,#f59e0b,#fcd34d); }
        .stat-card.c-common::before { background: linear-gradient(90deg,#10b981,#6ee7b7); }
        .stat-card-icon { font-size: 1.8rem; margin-bottom: 0.3rem; }
        .stat-card-label { font-size: 0.85rem; color: var(--muted); font-weight: 600; }
        .stat-card-value { font-size: 1.35rem; font-weight: 700; color: var(--text); margin-top: 0.2rem; }
        .stat-card.c-total  .stat-card-value { color: var(--primary); }
        .stat-card.c-water  .stat-card-value { color: var(--info); }
        .stat-card.c-elec   .stat-card-value { color: var(--warning); }
        .stat-card.c-common .stat-card-value { color: var(--success); }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            width: 100%;
            max-width: 1000px;
        }
        @media (max-width: 700px) { .charts-grid { grid-template-columns: 1fr; } }
        .chart-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.2rem 1.5rem;
            box-shadow: var(--shadow);
        }
        .chart-card-full {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.2rem 1.5rem;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 1000px;
        }
        .chart-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle" title="ขยาย/ย่อเมนู">☰</button>
        <nav class="sidebar-menu">
            <button class="sidebar-link" onclick="navigate('?page=dashboard')">
                <span class="sidebar-link-icon">🏠</span>
                <span class="sidebar-label">แดชบอร์ด</span>
            </button>
            <button class="sidebar-link active" onclick="navigate('?page=payment-history')">
                <span class="sidebar-link-icon">💸</span>
                <span class="sidebar-label">ข้อมูลการชำระย้อนหลัง</span>
            </button>
            <button class="sidebar-link" onclick="navigate('?page=form')">
                <span class="sidebar-link-icon">📝</span>
                <span class="sidebar-label">แบบฟอร์มคำร้อง</span>
            </button>
            <button class="sidebar-link" onclick="navigate('?page=regulations')">
                <span class="sidebar-link-icon">📚</span>
                <span class="sidebar-label">ระเบียบ</span>
            </button>
            <button class="sidebar-link" onclick="navigate('?page=settings')">
                <span class="sidebar-link-icon">⚙️</span>
                <span class="sidebar-label">ตั้งค่าส่วนตัว</span>
            </button>
            <button class="sidebar-link" onclick="navigate('?page=team-management')">
                <span class="sidebar-link-icon">👥</span>
                <span class="sidebar-label">โปรแกรมบริหารจัดการ</span>
            </button>
            <button class="sidebar-link" onclick="doLogout()" style="margin-top:auto;border-top:1px solid rgba(255,255,255,0.12);color:#fca5a5;">
                <span class="sidebar-link-icon">🚪</span>
                <span class="sidebar-label">ออกจากระบบ</span>
            </button>

        </nav>
    </div>

    <div class="dashboard-container" id="dashboardContainer">
        <div class="dashboard-header">
            <span class="dashboard-header-icon">💸</span>
            <h2>ข้อมูลการชำระเงินย้อนหลัง</h2>
        </div>

        <!-- Stat Cards -->
        <div class="stat-grid">
            <div class="stat-card c-total">
                <div class="stat-card-icon">💰</div>
                <div class="stat-card-label">ยอดชำระรวมทั้งปี</div>
                <div class="stat-card-value" id="statTotal">-</div>
            </div>
            <div class="stat-card c-water">
                <div class="stat-card-icon">💧</div>
                <div class="stat-card-label">ค่าน้ำรวม</div>
                <div class="stat-card-value" id="statWater">-</div>
            </div>
            <div class="stat-card c-elec">
                <div class="stat-card-icon">⚡</div>
                <div class="stat-card-label">ค่าไฟรวม</div>
                <div class="stat-card-value" id="statElec">-</div>
            </div>
            <div class="stat-card c-common">
                <div class="stat-card-icon">🏢</div>
                <div class="stat-card-label">ค่าส่วนกลางรวม</div>
                <div class="stat-card-value" id="statCommon">-</div>
            </div>
        </div>

        <!-- Charts: Stacked Bar + Doughnut -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">📊 ค่าใช้จ่ายรายเดือน (แยกตามประเภท)</div>
                <canvas id="chartBar" height="220"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">🧩 สัดส่วนค่าใช้จ่าย</div>
                <canvas id="chartDoughnut" height="220"></canvas>
            </div>
        </div>

        <!-- Line Chart -->
        <div class="chart-card-full">
            <div class="chart-title">📈 แนวโน้มยอดชำระรายเดือน</div>
            <canvas id="chartLine" height="110"></canvas>
        </div>

        <div class="filter-section">
            <label for="month">เลือกเดือน:</label>
            <select id="month">
                <option value="">— ทั้งปี —</option>
                <option value="01">มกราคม</option>
                <option value="02">กุมภาพันธ์</option>
                <option value="03">มีนาคม</option>
                <option value="04">เมษายน</option>
                <option value="05">พฤษภาคม</option>
                <option value="06">มิถุนายน</option>
                <option value="07">กรกฎาคม</option>
                <option value="08">สิงหาคม</option>
                <option value="09">กันยายน</option>
                <option value="10">ตุลาคม</option>
                <option value="11">พฤศจิกายน</option>
                <option value="12">ธันวาคม</option>
            </select>

            <label for="year">เลือกปี:</label>
            <select id="year">
                <script>
                    (function(){
                        var cy = new Date().getFullYear() + 543;
                        for(var y = cy + 1; y >= cy - 5; y--){
                            document.write('<option value="' + y + '"' + (y === cy ? ' selected' : '') + '>' + y + '</option>');
                        }
                    })();
                </script>
            </select>

            <button class="filter-btn" onclick="filterHistory()">กรองข้อมูล</button>
        </div>

        <div class="payment-history-container">
            <table>
                <thead>
                    <tr>
                        <th>เดือน</th>
                        <th>ปี</th>
                        <th>วันที่ชำระ</th>
                        <th>ค่าน้ำ (บาท)</th>
                        <th>ค่าไฟ (บาท)</th>
                        <th>ค่าส่วนกลาง (บาท)</th>
                        <th>ยอดรวม (บาท)</th>
                    </tr>
                </thead>
                <tbody id="payment-history-body">
                </tbody>
            </table>
        </div>

        <div style="text-align:center; margin-top:1.5rem; font-size:0.95rem; color:#888;">
            ออกแบบและพัฒนาโดย ครูพงศธร โพธิแก้ว<br>
            งานส่งเสริม กำกับ ดูแล และพัฒนาบ้านพักครู โรงเรียนพะเยาพิทยาคม
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>

        // ============ Constants ============
        const THAI_MONTHS = ['มกราคม','กุมภาพันธ์','มีนาคม','เมษายน','พฤษภาคม','มิถุนายน','กรกฎาคม','สิงหาคม','กันยายน','ตุลาคม','พฤศจิกายน','ธันวาคม'];
        const THAI_MONTHS_SHORT = ['ม.ค.','ก.พ.','มี.ค.','เม.ย.','พ.ค.','มิ.ย.','ก.ค.','ส.ค.','ก.ย.','ต.ค.','พ.ย.','ธ.ค.'];

        let allHistoryData = [];
        let chartBar, chartDoughnut, chartLine;

        // ============ Stat Cards ============
        function updateStats(data) {
            const fmt = v => v > 0 ? v.toLocaleString('th-TH') + ' บ.' : '-';
            const total    = data.reduce((s,r) => s + (r.total || r.water+r.electric+r.common), 0);
            const water    = data.reduce((s,r) => s + r.water, 0);
            const electric = data.reduce((s,r) => s + r.electric, 0);
            const common   = data.reduce((s,r) => s + r.common, 0);
            document.getElementById('statTotal').textContent   = fmt(total);
            document.getElementById('statWater').textContent   = fmt(water);
            document.getElementById('statElec').textContent    = fmt(electric);
            document.getElementById('statCommon').textContent  = fmt(common);
        }

        // ============ Charts ============
        function renderCharts(data) {
            const months = Array.from({length:12}, (_,i) => String(i+1).padStart(2,'0'));
            const byMonth = {};
            months.forEach(m => { byMonth[m] = {water:0, electric:0, common:0}; });
            data.forEach(r => {
                const m = String(r.month).padStart(2,'0');
                if (byMonth[m]) {
                    byMonth[m].water    += r.water;
                    byMonth[m].electric += r.electric;
                    byMonth[m].common   += r.common;
                }
            });

            const labels    = months.map(m => THAI_MONTHS_SHORT[parseInt(m)-1]);
            const waterArr  = months.map(m => byMonth[m].water);
            const elecArr   = months.map(m => byMonth[m].electric);
            const commonArr = months.map(m => byMonth[m].common);
            const totalArr  = months.map(m => byMonth[m].water + byMonth[m].electric + byMonth[m].common);

            if (chartBar)      chartBar.destroy();
            if (chartDoughnut) chartDoughnut.destroy();
            if (chartLine)     chartLine.destroy();

            const fontKanit = { family: 'Kanit, sans-serif' };

            // Stacked Bar
            chartBar = new Chart(document.getElementById('chartBar'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        { label: 'ค่าน้ำ',       data: waterArr,  backgroundColor: 'rgba(6,182,212,0.82)',   borderRadius: 3 },
                        { label: 'ค่าไฟ',       data: elecArr,   backgroundColor: 'rgba(245,158,11,0.82)',  borderRadius: 3 },
                        { label: 'ค่าส่วนกลาง', data: commonArr, backgroundColor: 'rgba(16,185,129,0.82)', borderRadius: 3 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top', labels: { font: fontKanit, boxWidth: 14, padding: 10 } },
                        tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y.toLocaleString('th-TH') + ' บ.' } }
                    },
                    scales: {
                        x: { stacked: true, ticks: { font: fontKanit } },
                        y: { stacked: true, beginAtZero: true, ticks: { font: fontKanit, callback: v => v.toLocaleString('th-TH') } }
                    }
                }
            });

            // Doughnut
            const totalW = waterArr.reduce((a,b)=>a+b,0);
            const totalE = elecArr.reduce((a,b)=>a+b,0);
            const totalC = commonArr.reduce((a,b)=>a+b,0);
            chartDoughnut = new Chart(document.getElementById('chartDoughnut'), {
                type: 'doughnut',
                data: {
                    labels: ['ค่าน้ำ','ค่าไฟ','ค่าส่วนกลาง'],
                    datasets: [{ data: [totalW, totalE, totalC],
                        backgroundColor: ['rgba(6,182,212,0.85)','rgba(245,158,11,0.85)','rgba(16,185,129,0.85)'],
                        borderWidth: 2, borderColor: '#fff', hoverOffset: 8 }]
                },
                options: {
                    responsive: true,
                    cutout: '62%',
                    plugins: {
                        legend: { position: 'bottom', labels: { font: fontKanit, padding: 12 } },
                        tooltip: { callbacks: { label: ctx => ctx.label + ': ' + ctx.parsed.toLocaleString('th-TH') + ' บ.' } }
                    }
                }
            });

            // Line
            chartLine = new Chart(document.getElementById('chartLine'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'ยอดชำระรวม',
                        data: totalArr,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37,99,235,0.07)',
                        borderWidth: 2.5,
                        pointRadius: 5,
                        pointBackgroundColor: '#2563eb',
                        tension: 0.35,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => 'ยอด: ' + ctx.parsed.y.toLocaleString('th-TH') + ' บ.' } }
                    },
                    scales: {
                        x: { ticks: { font: fontKanit } },
                        y: { beginAtZero: true, ticks: { font: fontKanit, callback: v => v.toLocaleString('th-TH') } }
                    }
                }
            });
        }

        // ============ โหลดข้อมูล ============
        async function loadPaymentHistory() {
            const year = document.getElementById('year').value;
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

            allHistoryData = [];

            // ลอง Backend ก่อน
            if (WEB_APP_URL && user.id) {
                try {
                    const result = await callBackendGet('getPaymentHistory', { userId: user.id, year: year });
                    if (result && result.success && result.data) {
                        allHistoryData = result.data.map(row => ({
                            month: String(row.month).padStart(2, '0'),
                            year: String(row.year || year),
                            paidDate: row.paid_date || row.reviewed_at || row.submitted_at || '-',
                            water: parseFloat(row.water_amount) || 0,
                            electric: parseFloat(row.electric_amount) || 0,
                            common: parseFloat(row.common_fee) || 0,
                            total: parseFloat(row.paid_amount || row.total_amount) || 0,
                            status: row.status || ''
                        }));
                    }
                } catch (e) { console.error('getPaymentHistory error:', e); }
            }

            // Fallback: localStorage
            if (allHistoryData.length === 0) {
                const unitNumber = localStorage.getItem('currentUserUnit') || user.house_number || '';
                for (let m = 1; m <= 12; m++) {
                    const mm = String(m).padStart(2, '0');
                    const key = 'slipSubmissions_' + year + mm;
                    const submissions = JSON.parse(localStorage.getItem(key) || '[]');
                    const mySlip = submissions.find(s => s.unitNumber === unitNumber && s.status === 'approved');
                    if (mySlip) {
                        allHistoryData.push({
                            month: mm,
                            year: year,
                            paidDate: mySlip.submittedAt ? new Date(mySlip.submittedAt).toLocaleDateString('th-TH') : '-',
                            water: parseFloat(mySlip.waterAmount) || 0,
                            electric: parseFloat(mySlip.electricAmount) || 0,
                            common: parseFloat(mySlip.commonFee) || 0,
                            total: parseFloat(mySlip.paidAmount) || 0,
                            status: mySlip.status
                        });
                    }
                }
            }

            renderTable(allHistoryData);
            updateStats(allHistoryData);
            renderCharts(allHistoryData);
        }

        // ============ แสดงตาราง ============
        function renderTable(data) {
            const tbody = document.getElementById('payment-history-body');
            tbody.innerHTML = '';

            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#999;padding:2rem;">ไม่พบข้อมูลการชำระเงิน</td></tr>';
                return;
            }

            data.forEach(item => {
                const monthIdx = parseInt(item.month) - 1;
                const monthName = THAI_MONTHS[monthIdx] || item.month;
                const total = item.total || (item.water + item.electric + item.common);
                const tr = document.createElement('tr');
                tr.innerHTML =
                    '<td>' + monthName + '</td>' +
                    '<td>' + item.year + '</td>' +
                    '<td>' + (item.paidDate || '-') + '</td>' +
                    '<td>' + (item.water ? item.water.toLocaleString() : '-') + '</td>' +
                    '<td>' + (item.electric ? item.electric.toLocaleString() : '-') + '</td>' +
                    '<td>' + (item.common ? item.common.toLocaleString() : '-') + '</td>' +
                    '<td>' + (total ? total.toLocaleString() : '-') + '</td>';
                tbody.appendChild(tr);
            });
        }

        // ============ กรอง ============
        function filterHistory() {
            const selectedMonth = document.getElementById('month').value;
            // โหลดใหม่จาก Backend (เผื่อเปลี่ยนปี) → กราฟแสดงทั้งปีเสมอ ตารางกรองตามเดือน
            loadPaymentHistory().then(() => {
                if (selectedMonth) {
                    const filtered = allHistoryData.filter(item => item.month === selectedMonth);
                    renderTable(filtered);
                    // stat cards อัปเดตตามการกรอง
                    updateStats(filtered);
                    // กราฟยังคงแสดงทั้งปี (ไม่กรอง) เพื่อให้เห็นภาพรวม
                }
            });
        }

        // ============ Sidebar ============
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        sidebarToggle.onclick = function() {
            sidebar.classList.toggle('expanded');
            document.getElementById('dashboardContainer').style.marginLeft = sidebar.classList.contains('expanded')
                ? (window.innerWidth <= 600 ? '160px' : '280px')
                : (window.innerWidth <= 600 ? '48px' : '62px');
        };
        document.getElementById('dashboardContainer').style.marginLeft = (window.innerWidth <= 600 ? '48px' : '62px');
        window.addEventListener('resize', function() {
            document.getElementById('dashboardContainer').style.marginLeft = sidebar.classList.contains('expanded')
                ? (window.innerWidth <= 600 ? '160px' : '280px')
                : (window.innerWidth <= 600 ? '48px' : '62px');
        });

        // ============ Init ============
        window.onload = async function() {
            const user = await checkSession();
            if (!user) return;
            // ตั้งเดือนปัจจุบัน
            document.getElementById('month').value = String(new Date().getMonth() + 1).padStart(2, '0');
            await loadPaymentHistory();
        };
    
        async function doLogout() {
            if (!await ppkConfirm('ยืนยันออกจากระบบ?')) return;
            var token = getSessionToken ? getSessionToken() : (localStorage.getItem('sessionToken') || '');
            if (token && WEB_APP_URL) {
                callBackend('logout', {}).catch(function(){});
            }
            localStorage.clear();
            navigate('?page=login');
        }
        </script>
    <script src="ppk-api.js"></script>
    <script src="ppk-utils.js"></script></body>
</html>
